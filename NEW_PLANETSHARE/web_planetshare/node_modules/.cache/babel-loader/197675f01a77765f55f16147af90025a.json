{"ast":null,"code":"var _jsxFileName = \"/var/www/html/REACT_WORK/NEW_PLANETSHARE/web_planetshare/src/Container/Payment/Payment.js\";\nimport React from 'react';\nimport Razorpay from 'razorpay';\nimport axios from 'axios';\nimport { Redirect } from 'react-router-dom';\nimport { PAYMENT, INITIATEORDER, GETPACKPRICE, USERID, TAG } from '../../url';\nimport Authentication from '../Authentication/Authentication';\nimport { withLastLocation } from 'react-router-last-location';\nimport LoadingGif from '../../Component/Loader/loading_gif';\nimport $ from 'jquery';\nimport { ToastContainer, toast, cssTransition } from 'react-toastify';\nconst Zoom = cssTransition({\n  enter: 'zoomIn',\n  exit: 'zoomOut',\n  duration: 750\n});\nconst HEADER = {\n  headers: {\n    'Content-Type': 'application/json;charset=UTF-8',\n    'Authorization': \"Bearer \" + localStorage.getItem('planetshare_web_token')\n  }\n};\n\nclass Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      payment_id: '',\n      order_id: '',\n      amount: 0,\n      pack_name: '',\n      id: '',\n      lastlocation: '',\n      not_found: false,\n      loading: true,\n      loading_msg: 'Please Wait'\n    };\n\n    this.getPrice = () => {\n      axios.post(GETPACKPRICE, {\n        user_id: localStorage.getItem('user_id'),\n        pack_id: this.state.pack_id,\n        pack_type: this.state.pack_name,\n        tag: TAG\n      }, {\n        headers: {\n          'Content-Type': 'application/json;charset=UTF-8',\n          'Authorization': \"Bearer \" + localStorage.getItem('planetshare_web_token')\n        }\n      }).then(res => {\n        if (res.data.success == 1) {\n          var response = res.data;\n\n          if (response.price == 0 || response.price == null) {\n            this.props.history.push('/web');\n          } else {\n            this.initiateOrder(response.price);\n          }\n        } else {\n          alert('You Already Bought A Pack');\n          localStorage.setItem('payment_status', null);\n          this.props.history.push('/web');\n        }\n      }).catch(error => {\n        localStorage.setItem('payment_status', null);\n        this.props.history.push('/web');\n      });\n    };\n\n    this.initiateOrder = price => {\n      axios.post(INITIATEORDER, {\n        user_id: localStorage.getItem('user_id'),\n        tag: TAG,\n        pack_id: this.state.pack_id,\n        pack_type: this.state.pack_name\n      }, {\n        headers: {\n          'Content-Type': 'application/json;charset=UTF-8',\n          'Authorization': \"Bearer \" + localStorage.getItem('planetshare_web_token')\n        }\n      }).then(res => {\n        if (res.data.success == 1) {\n          var order_id = res.data.order_id;\n\n          if (order_id == '') {\n            localStorage.setItem('payment_status', null);\n            setTimeout(() => {\n              this.setState({\n                loading: false\n              });\n              this.props.history.push('/web');\n            }, 1000);\n          } else {\n            setTimeout(() => {\n              this.setState({\n                loading: false\n              });\n              this.openCheckout(price, this.state.pack_id, order_id, localStorage.getItem('lastLocation'));\n            }, 1000);\n          }\n        } else if (res.data.success == 2) {\n          toast(res.data.data.msg, {\n            transition: Zoom\n          });\n          localStorage.setItem('payment_status', null);\n          setTimeout(() => {\n            this.setState({\n              loading: false\n            });\n            this.props.history.push('/web');\n          }, 1000);\n        }\n      }).catch(error => {\n        localStorage.setItem('payment_status', null);\n      });\n    };\n\n    this.getdetails = id => {\n      axios.post(`https://api.razorpay.com/v1/payments/:${id}`, {}).then(response => {\n        console.log(response);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    };\n\n    this.sendPaymentId = paymentId => {\n      alert(paymentId);\n    };\n\n    this.openCheckout = (amount, pack_id, order_id, redirect_url) => {\n      // var amounts=Math.round(amount)*100;\n      // alert(amounts);\n      var x = this.state.amount;\n\n      let _this = this;\n\n      let options = {\n        \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n        \"amount\": Math.round(amount * 100),\n        // 2000 paise = INR 20, amount in paisa\n        \"currency\": \"INR\",\n        \"name\": localStorage.getItem('name'),\n        \"description\": \"Purchase Description\",\n        \"image\": \"images/favicon.png\",\n        \"handler\": function (response, _this) {\n          $('#loader_cont').show();\n          axios.post(PAYMENT, {\n            user_id: localStorage.getItem('user_id'),\n            order_id: order_id,\n            tag: TAG,\n            payment_id: response.razorpay_payment_id,\n            pack_id: pack_id\n          }, {\n            headers: {\n              'Content-Type': 'application/json;charset=UTF-8',\n              'Authorization': \"Bearer \" + localStorage.getItem('planetshare_web_token')\n            }\n          }).then(response => {\n            if (response.data.success == 1) {\n              localStorage.setItem('payment_status', null);\n              localStorage.setItem('lastLocation', null);\n              localStorage.setItem('address_payment_status', null); //  setTimeout(()=>{_this.props.history.push(redirect_url)},2000);\n\n              setTimeout(() => {\n                window.location.href = '#' + redirect_url + '';\n              }, 2000);\n            } else {\n              localStorage.setItem('payment_status', null);\n              localStorage.setItem('lastLocation', null);\n              localStorage.setItem('address_payment_status', null);\n              window.location.href = '#' + redirect_url + '';\n            }\n          }).catch(function (error) {\n            console.log(error);\n          }); // let data = {\n          //   \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n          //   \"amount\":\"500\", // 2000 paise = INR 20, amount in paisa\n          //   \"hostUrl\":`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`\n          // }\n          //   axios.post(`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`,\n          // {key_id:'rzp_test_hgYa6e7RNnPSJf',amount:x,checkcookie:1})\n          // .then(response=>{\n          //   console.log(response);\n          // })\n          // .catch(function (error) {\n          //   console.log(error);\n          // });\n        },\n        \"modal\": {\n          \"ondismiss\": function () {\n            window.location.href = '#' + redirect_url + '';\n          }\n        },\n        \"prefill\": {\n          \"name\": \"Shantanu Gupta\",\n          \"email\": \"shantanug.sw@planetc.net\",\n          \"contact\": \"9654636775\"\n        },\n        \"notes\": {\n          \"address\": \"Thanks\"\n        },\n        \"theme\": {\n          \"color\": \"#3583D2\"\n        }\n      };\n      let rzp = new window.Razorpay(options);\n      rzp.open();\n    };\n\n    this.changeAmount = this.changeAmount.bind(this);\n    this.openCheckout = this.openCheckout.bind(this);\n    this.getdetails = this.getdetails.bind(this);\n  }\n\n  componentDidMount() {\n    var data = this.props.location.data;\n\n    if (this.props.lastLocation == null) {\n      this.props.history.push('/web');\n      return false;\n    } else {\n      if (localStorage.getItem('payment_status') == 1) {\n        this.setState({\n          pack_id: this.props.match.params.pack_id,\n          pack_name: this.props.match.params.pack_name\n        }, function () {\n          this.getPrice();\n        });\n      } else {\n        localStorage.setItem('payment_status', null);\n        this.props.history.push('/web');\n      }\n    }\n  } // componentDidUpdate()\n  // {\n  //   if(this.props.match.params.pack_id!=this.state.pack_id)\n  //   {\n  //     if(localStorage.getItem('payment_status')==1)\n  //     {\n  //       this.setState({pack_id:this.props.match.params.pack_id,loading:false},function()\n  //         {\n  //             this.getPrice()\n  //           })\n  //     }\n  //   }\n  // }\n\n\n  changeAmount(e) {\n    this.setState({\n      amount: e.target.value\n    });\n  }\n\n  render() {\n    const _this$state = this.state,\n          loading = _this$state.loading,\n          loading_msg = _this$state.loading_msg;\n\n    if (!loading) {\n      return React.createElement(\"div\", {\n        id: \"loader_cont\",\n        style: {\n          display: 'none'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, React.createElement(LoadingGif, {\n        message: loading_msg,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }));\n    } else {\n      return React.createElement(LoadingGif, {\n        message: loading_msg,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      });\n    }\n  }\n\n}\n\nexport default withLastLocation(Authentication(Checkout)); // <input type='text' onChange={\n//    this.changeAmount\n//   } />","map":{"version":3,"sources":["/var/www/html/REACT_WORK/NEW_PLANETSHARE/web_planetshare/src/Container/Payment/Payment.js"],"names":["React","Razorpay","axios","Redirect","PAYMENT","INITIATEORDER","GETPACKPRICE","USERID","TAG","Authentication","withLastLocation","LoadingGif","$","ToastContainer","toast","cssTransition","Zoom","enter","exit","duration","HEADER","headers","localStorage","getItem","Checkout","Component","constructor","props","state","payment_id","order_id","amount","pack_name","id","lastlocation","not_found","loading","loading_msg","getPrice","post","user_id","pack_id","pack_type","tag","then","res","data","success","response","price","history","push","initiateOrder","alert","setItem","catch","error","setTimeout","setState","openCheckout","msg","transition","getdetails","console","log","sendPaymentId","paymentId","redirect_url","x","_this","options","Math","round","show","razorpay_payment_id","window","location","href","rzp","open","changeAmount","bind","componentDidMount","lastLocation","match","params","e","target","value","render","display"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Razorpay from 'razorpay';\nimport axios from 'axios';\nimport  {Redirect} from 'react-router-dom';\nimport {PAYMENT,INITIATEORDER,GETPACKPRICE,USERID,TAG} from '../../url'\nimport Authentication from '../Authentication/Authentication'\nimport { withLastLocation } from 'react-router-last-location';\nimport LoadingGif from '../../Component/Loader/loading_gif'\nimport $ from 'jquery';\nimport { ToastContainer, toast,cssTransition} from 'react-toastify';\nconst Zoom = cssTransition({\nenter: 'zoomIn',\nexit: 'zoomOut',\nduration: 750,\n});\nconst HEADER = {\nheaders: {\n  'Content-Type': 'application/json;charset=UTF-8',\n  'Authorization':\"Bearer \" + localStorage.getItem('planetshare_web_token'),\n}\n};\nclass Checkout extends React.Component{\n  state = {\n    payment_id:'',\n    order_id:'',amount:0,pack_name:'',\n    id:'',lastlocation:'',not_found:false,loading:true,loading_msg:'Please Wait',\n  };\n\n  constructor(props) {\n    super(props)\n    this.changeAmount = this.changeAmount.bind(this);\n    this.openCheckout = this.openCheckout.bind(this);\n    this.getdetails = this.getdetails.bind(this);\n  }\n  componentDidMount()\n  {\n    var data=this.props.location.data;\n    if(this.props.lastLocation==null)\n    {\n      this.props.history.push('/web');\n      return false;\n    }\n    else {\n    if(localStorage.getItem('payment_status')==1)\n    {\n      this.setState({pack_id:this.props.match.params.pack_id,pack_name:this.props.match.params.pack_name},function()\n        {\n            this.getPrice()\n          })\n    }\n    else {\n      localStorage.setItem('payment_status',null);\n      this.props.history.push('/web')\n    }\n  }\n  }\n  // componentDidUpdate()\n  // {\n  //   if(this.props.match.params.pack_id!=this.state.pack_id)\n  //   {\n  //     if(localStorage.getItem('payment_status')==1)\n  //     {\n  //       this.setState({pack_id:this.props.match.params.pack_id,loading:false},function()\n  //         {\n  //             this.getPrice()\n  //           })\n  //     }\n  //   }\n  // }\n  getPrice=()=>{\n    axios.post(GETPACKPRICE,{user_id:localStorage.getItem('user_id'),pack_id:this.state.pack_id,pack_type:this.state.pack_name,tag:TAG},{\n    headers: {\n      'Content-Type': 'application/json;charset=UTF-8',\n      'Authorization':\"Bearer \" + localStorage.getItem('planetshare_web_token'),\n    }\n    }).then((res)=>{\n      if(res.data.success==1)\n      {\n        var response=res.data;\n        if(response.price==0 || response.price==null)\n        {\n          this.props.history.push('/web')\n        }\n        else {\n          this.initiateOrder(response.price);\n        }\n      }\n      else {\n        alert('You Already Bought A Pack');\n        localStorage.setItem('payment_status',null);\n        this.props.history.push('/web')\n      }\n    }).catch((error)=>{\n      localStorage.setItem('payment_status',null);\n      this.props.history.push('/web')\n    })\n  }\n  initiateOrder=(price)=>{\n    axios.post(INITIATEORDER,{user_id:localStorage.getItem('user_id'),tag:TAG,pack_id:this.state.pack_id,pack_type:this.state.pack_name},{\n    headers: {\n      'Content-Type': 'application/json;charset=UTF-8',\n      'Authorization':\"Bearer \" + localStorage.getItem('planetshare_web_token'),\n    }\n    }).then((res)=>{\n      if(res.data.success==1)\n      {\n        var order_id=res.data.order_id;\n        if(order_id=='')\n        {\n          localStorage.setItem('payment_status',null);\n          setTimeout(()=>{this.setState({loading:false});this.props.history.push('/web')},1000);\n        }\n        else {\n          setTimeout(()=>{this.setState({loading:false});this.openCheckout(price,this.state.pack_id,order_id,localStorage.getItem('lastLocation'))},1000);\n        }\n      }\n      else if(res.data.success==2)\n      {\n        toast(res.data.data.msg,{ transition: Zoom,});\n        localStorage.setItem('payment_status',null);\n      setTimeout(()=>{this.setState({loading:false});this.props.history.push('/web')},1000);\n      }\n    }).catch((error)=>{\n      localStorage.setItem('payment_status',null);\n    })\n  }\n  getdetails=(id)=>\n  {\n    axios.post(`https://api.razorpay.com/v1/payments/:${id}`,{\n    })\n  .then(response=>{\n    console.log(response);\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n  }\n  changeAmount(e) {\n    this.setState({amount: e.target.value})\n  }\n  sendPaymentId=(paymentId)=>{\n    alert(paymentId);\n  }\n  openCheckout=(amount,pack_id,order_id,redirect_url)=>{\n    // var amounts=Math.round(amount)*100;\n    // alert(amounts);\n  var x=this.state.amount;\n  let _this=this;\n    let options = {\n      \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n      \"amount\": Math.round(amount*100), // 2000 paise = INR 20, amount in paisa\n      \"currency\": \"INR\",\n      \"name\": localStorage.getItem('name'),\n      \"description\": \"Purchase Description\",\n      \"image\": \"images/favicon.png\",\n      \"handler\": function(response,_this){\n          $('#loader_cont').show();\n          axios.post(PAYMENT,\n        {user_id:localStorage.getItem('user_id'),order_id:order_id,tag:TAG,payment_id:response.razorpay_payment_id,pack_id:pack_id},{\n        headers: {\n          'Content-Type': 'application/json;charset=UTF-8',\n          'Authorization':\"Bearer \" + localStorage.getItem('planetshare_web_token'),\n        }\n        })\n        .then(response=>{\n          if(response.data.success==1)\n          {\n            localStorage.setItem('payment_status',null);\n            localStorage.setItem('lastLocation',null);\n            localStorage.setItem('address_payment_status',null);\n          //  setTimeout(()=>{_this.props.history.push(redirect_url)},2000);\n            setTimeout(()=>{window.location.href='#'+redirect_url+''},2000);\n          }\n          else {\n            localStorage.setItem('payment_status',null);\n            localStorage.setItem('lastLocation',null);\n            localStorage.setItem('address_payment_status',null);\n            window.location.href='#'+redirect_url+'';\n          }\n        })\n        .catch(function (error) {\n          console.log(error);\n        })\n\n        // let data = {\n        //   \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n        //   \"amount\":\"500\", // 2000 paise = INR 20, amount in paisa\n        //   \"hostUrl\":`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`\n        // }\n      //   axios.post(`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`,\n      // {key_id:'rzp_test_hgYa6e7RNnPSJf',amount:x,checkcookie:1})\n      // .then(response=>{\n      //   console.log(response);\n      // })\n      // .catch(function (error) {\n      //   console.log(error);\n      // });\n            },\n            \"modal\": {\n              \"ondismiss\": function(){\n                  window.location.href='#'+redirect_url+'';\n               }\n          },\n      \"prefill\": {\n        \"name\": \"Shantanu Gupta\",\n        \"email\": \"shantanug.sw@planetc.net\",\n        \"contact\":\"9654636775\"\n      },\n      \"notes\": {\n        \"address\": \"Thanks\"\n      },\n      \"theme\": {\n        \"color\": \"#3583D2\"\n      }\n    };\n\n    let rzp =new window.Razorpay(options); rzp.open();\n  }\n\n  render () {\n    const {loading,loading_msg}=this.state;\n    if(!loading)\n    {\n      return (\n        <div id=\"loader_cont\" style={{display:'none'}}><LoadingGif message={loading_msg}/>\n           </div>\n      )\n    }\n    else {\n      return(<LoadingGif message={loading_msg}/>)\n    }\n  }\n}\n\nexport default withLastLocation(Authentication(Checkout));\n// <input type='text' onChange={\n//    this.changeAmount\n//   } />\n"]},"metadata":{},"sourceType":"module"}