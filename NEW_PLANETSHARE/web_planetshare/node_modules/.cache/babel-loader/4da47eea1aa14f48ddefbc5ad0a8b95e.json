{"ast":null,"code":"var _jsxFileName = \"/var/www/html/REACT_WORK/NEW_PLANETSHARE/web_planetshare/src/Container/Payment/Payment.js\";\nimport React from 'react';\nimport Razorpay from 'razorpay';\nimport axios from 'axios';\nimport { Redirect } from 'react-router-dom';\nimport { PAYMENT, INITIATEORDER, GETPACKPRICE, USERID, TAG } from '../../url';\nimport Authentication from '../Authentication/Authentication';\nimport { withLastLocation } from 'react-router-last-location';\nimport ActivityLoader from 'react-loader-spinner';\nimport $ from 'jquery';\nimport { ToastContainer, toast, cssTransition } from 'react-toastify';\nconst Zoom = cssTransition({\n  enter: 'zoomIn',\n  exit: 'zoomOut',\n  duration: 750\n});\nconst HEADER = {\n  headers: {\n    'Content-Type': 'application/json;charset=UTF-8',\n    'Authorization': \"Bearer \" + localStorage.getItem('planetshare_web_token')\n  }\n};\n\nclass Checkout extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      payment_id: '',\n      order_id: '',\n      amount: 0,\n      id: '',\n      lastlocation: '',\n      not_found: false,\n      loading: true,\n      loading_msg: 'Please Wait'\n    };\n\n    this.getPrice = () => {\n      axios.post(GETPACKPRICE, {\n        user_id: localStorage.getItem('user_id'),\n        pack_id: this.state.pack_id,\n        tag: TAG\n      }, HEADER).then(res => {\n        if (res.data.success == 1) {\n          var response = res.data;\n\n          if (response.price == 0 || response.price == null) {\n            this.props.history.push('/web');\n          } else {\n            this.initiateOrder(response.price);\n          }\n        } else {\n          alert('You Already Bought A Pack');\n          this.props.history.push('/web');\n        }\n      }).catch(error => {\n        this.props.history.push('/web');\n      });\n    };\n\n    this.initiateOrder = price => {\n      axios.post(INITIATEORDER, {\n        user_id: localStorage.getItem('user_id'),\n        tag: TAG,\n        pack_id: this.state.pack_id\n      }, HEADER).then(res => {\n        if (res.data.success == 1) {\n          var order_id = res.data.order_id;\n\n          if (order_id == '') {\n            setTimeout(() => {\n              this.setState({\n                loading: false\n              });\n              this.props.history.push('/web');\n            }, 1000);\n          } else {\n            setTimeout(() => {\n              this.setState({\n                loading: false\n              });\n              this.openCheckout(price, this.state.pack_id, order_id, '/web/orders');\n            }, 1000);\n          }\n        } else if (res.data.success == 2) {\n          toast(res.data.data.msg, {\n            transition: Zoom\n          });\n          setTimeout(() => {\n            this.setState({\n              loading: false\n            });\n            this.props.history.push('/web');\n          }, 1000);\n        }\n      }).catch(error => {});\n    };\n\n    this.getdetails = id => {\n      axios.post(`https://api.razorpay.com/v1/payments/:${id}`, {}).then(response => {\n        console.log(response);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    };\n\n    this.sendPaymentId = paymentId => {\n      alert(paymentId);\n    };\n\n    this.openCheckout = (amount, pack_id, order_id, redirect_url) => {\n      // var amounts=Math.round(amount)*100;\n      // alert(amounts);\n      var x = this.state.amount;\n\n      let _this = this;\n\n      let options = {\n        \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n        \"amount\": Math.round(amount * 100),\n        // 2000 paise = INR 20, amount in paisa\n        \"currency\": \"INR\",\n        \"name\": localStorage.getItem('name'),\n        \"description\": \"Purchase Description\",\n        \"image\": \"images/favicon.png\",\n        \"handler\": function (response, _this) {\n          $('#loader_cont').show();\n          axios.post(PAYMENT, {\n            user_id: localStorage.getItem('user_id'),\n            order_id: order_id,\n            tag: TAG,\n            payment_id: response.razorpay_payment_id,\n            pack_id: pack_id\n          }, HEADER).then(response => {\n            if (response.data.success == 1) {\n              localStorage.setItem('payment_status', null); //  setTimeout(()=>{_this.props.history.push(redirect_url)},2000);\n\n              setTimeout(() => {\n                window.location.href = '#' + redirect_url + '';\n              }, 2000);\n            } else {\n              window.location.href = '#' + redirect_url + '';\n            }\n          }).catch(function (error) {\n            console.log(error);\n          }); // let data = {\n          //   \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n          //   \"amount\":\"500\", // 2000 paise = INR 20, amount in paisa\n          //   \"hostUrl\":`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`\n          // }\n          //   axios.post(`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`,\n          // {key_id:'rzp_test_hgYa6e7RNnPSJf',amount:x,checkcookie:1})\n          // .then(response=>{\n          //   console.log(response);\n          // })\n          // .catch(function (error) {\n          //   console.log(error);\n          // });\n        },\n        \"modal\": {\n          \"ondismiss\": function () {\n            window.location.href = '#' + redirect_url + '';\n          }\n        },\n        \"prefill\": {\n          \"name\": \"Shantanu Gupta\",\n          \"email\": \"shaang616@gmail.com\",\n          \"contact\": \"9654636775\"\n        },\n        \"notes\": {\n          \"address\": \"Hello World\"\n        },\n        \"theme\": {\n          \"color\": \"#3583D2\"\n        }\n      };\n      let rzp = new window.Razorpay(options);\n      rzp.open();\n    };\n\n    this.changeAmount = this.changeAmount.bind(this);\n    this.openCheckout = this.openCheckout.bind(this);\n    this.getdetails = this.getdetails.bind(this);\n  }\n\n  componentDidMount() {\n    var data = this.props.location.data;\n\n    if (localStorage.getItem('payment_status') == 1) {\n      this.setState({\n        pack_id: this.props.match.params.pack_id\n      }, function () {\n        this.getPrice();\n      });\n    } else {\n      this.props.history.push('/web');\n    }\n  } // componentDidUpdate()\n  // {\n  //   if(this.props.match.params.pack_id!=this.state.pack_id)\n  //   {\n  //     if(localStorage.getItem('payment_status')==1)\n  //     {\n  //       this.setState({pack_id:this.props.match.params.pack_id,loading:false},function()\n  //         {\n  //             this.getPrice()\n  //           })\n  //     }\n  //   }\n  // }\n\n\n  changeAmount(e) {\n    this.setState({\n      amount: e.target.value\n    });\n  }\n\n  render() {\n    const _this$state = this.state,\n          loading = _this$state.loading,\n          loading_msg = _this$state.loading_msg;\n\n    if (!loading) {\n      return React.createElement(\"div\", {\n        class: \"container loader_cont\",\n        id: \"loader_cont\",\n        style: {\n          display: 'none'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(ActivityLoader, {\n        type: \"Triangle\",\n        color: \"black\",\n        height: 100,\n        width: 100,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, loading_msg));\n    } else {\n      return React.createElement(\"div\", {\n        class: \"container loader_cont\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, React.createElement(ActivityLoader, {\n        type: \"Triangle\",\n        color: \"black\",\n        height: 100,\n        width: 100,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, loading_msg));\n    }\n  }\n\n}\n\nexport default Authentication(Checkout); // <input type='text' onChange={\n//    this.changeAmount\n//   } />","map":{"version":3,"sources":["/var/www/html/REACT_WORK/NEW_PLANETSHARE/web_planetshare/src/Container/Payment/Payment.js"],"names":["React","Razorpay","axios","Redirect","PAYMENT","INITIATEORDER","GETPACKPRICE","USERID","TAG","Authentication","withLastLocation","ActivityLoader","$","ToastContainer","toast","cssTransition","Zoom","enter","exit","duration","HEADER","headers","localStorage","getItem","Checkout","Component","constructor","props","state","payment_id","order_id","amount","id","lastlocation","not_found","loading","loading_msg","getPrice","post","user_id","pack_id","tag","then","res","data","success","response","price","history","push","initiateOrder","alert","catch","error","setTimeout","setState","openCheckout","msg","transition","getdetails","console","log","sendPaymentId","paymentId","redirect_url","x","_this","options","Math","round","show","razorpay_payment_id","setItem","window","location","href","rzp","open","changeAmount","bind","componentDidMount","match","params","e","target","value","render","display"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Razorpay from 'razorpay';\nimport axios from 'axios';\nimport  {Redirect} from 'react-router-dom';\nimport {PAYMENT,INITIATEORDER,GETPACKPRICE,USERID,TAG} from '../../url'\nimport Authentication from '../Authentication/Authentication'\nimport { withLastLocation } from 'react-router-last-location';\nimport ActivityLoader from 'react-loader-spinner';\nimport $ from 'jquery';\nimport { ToastContainer, toast,cssTransition} from 'react-toastify';\nconst Zoom = cssTransition({\nenter: 'zoomIn',\nexit: 'zoomOut',\nduration: 750,\n});\nconst HEADER = {\nheaders: {\n  'Content-Type': 'application/json;charset=UTF-8',\n  'Authorization':\"Bearer \" + localStorage.getItem('planetshare_web_token'),\n}\n};\nclass Checkout extends React.Component{\n  state = {\n    payment_id:'',\n    order_id:'',amount:0,\n    id:'',lastlocation:'',not_found:false,loading:true,loading_msg:'Please Wait',\n  };\n\n  constructor(props) {\n    super(props)\n    this.changeAmount = this.changeAmount.bind(this);\n    this.openCheckout = this.openCheckout.bind(this);\n    this.getdetails = this.getdetails.bind(this);\n  }\n  componentDidMount()\n  {\n    var data=this.props.location.data;\n    if(localStorage.getItem('payment_status')==1)\n    {\n      this.setState({pack_id:this.props.match.params.pack_id},function()\n        {\n            this.getPrice()\n          })\n    }\n    else {\n      this.props.history.push('/web')\n    }\n\n  }\n  // componentDidUpdate()\n  // {\n  //   if(this.props.match.params.pack_id!=this.state.pack_id)\n  //   {\n  //     if(localStorage.getItem('payment_status')==1)\n  //     {\n  //       this.setState({pack_id:this.props.match.params.pack_id,loading:false},function()\n  //         {\n  //             this.getPrice()\n  //           })\n  //     }\n  //   }\n  // }\n  getPrice=()=>{\n    axios.post(GETPACKPRICE,{user_id:localStorage.getItem('user_id'),pack_id:this.state.pack_id,tag:TAG},HEADER).then((res)=>{\n      if(res.data.success==1)\n      {\n        var response=res.data;\n        if(response.price==0 || response.price==null)\n        {\n          this.props.history.push('/web')\n        }\n        else {\n          this.initiateOrder(response.price);\n        }\n      }\n      else {\n        alert('You Already Bought A Pack')\n        this.props.history.push('/web')\n      }\n    }).catch((error)=>{\n      this.props.history.push('/web')\n    })\n  }\n  initiateOrder=(price)=>{\n    axios.post(INITIATEORDER,{user_id:localStorage.getItem('user_id'),tag:TAG,pack_id:this.state.pack_id},HEADER).then((res)=>{\n      if(res.data.success==1)\n      {\n        var order_id=res.data.order_id;\n        if(order_id=='')\n        {\n          setTimeout(()=>{this.setState({loading:false});this.props.history.push('/web')},1000);\n        }\n        else {\n          setTimeout(()=>{this.setState({loading:false});this.openCheckout(price,this.state.pack_id,order_id,'/web/orders')},1000);\n        }\n      }\n      else if(res.data.success==2)\n      {\n        toast(res.data.data.msg,{ transition: Zoom,});\n      setTimeout(()=>{this.setState({loading:false});this.props.history.push('/web')},1000);\n      }\n    }).catch((error)=>{\n\n    })\n  }\n  getdetails=(id)=>\n  {\n    axios.post(`https://api.razorpay.com/v1/payments/:${id}`,{\n    })\n  .then(response=>{\n    console.log(response);\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n  }\n  changeAmount(e) {\n    this.setState({amount: e.target.value})\n  }\n  sendPaymentId=(paymentId)=>{\n    alert(paymentId);\n  }\n  openCheckout=(amount,pack_id,order_id,redirect_url)=>{\n    // var amounts=Math.round(amount)*100;\n    // alert(amounts);\n  var x=this.state.amount;\n  let _this=this;\n    let options = {\n      \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n      \"amount\": Math.round(amount*100), // 2000 paise = INR 20, amount in paisa\n      \"currency\": \"INR\",\n      \"name\": localStorage.getItem('name'),\n      \"description\": \"Purchase Description\",\n      \"image\": \"images/favicon.png\",\n      \"handler\": function(response,_this){\n          $('#loader_cont').show();\n          axios.post(PAYMENT,\n        {user_id:localStorage.getItem('user_id'),order_id:order_id,tag:TAG,payment_id:response.razorpay_payment_id,pack_id:pack_id},HEADER)\n        .then(response=>{\n          if(response.data.success==1)\n          {\n            localStorage.setItem('payment_status',null);\n          //  setTimeout(()=>{_this.props.history.push(redirect_url)},2000);\n            setTimeout(()=>{window.location.href='#'+redirect_url+''},2000);\n          }\n          else {\n            window.location.href='#'+redirect_url+'';\n          }\n        })\n        .catch(function (error) {\n          console.log(error);\n        })\n\n        // let data = {\n        //   \"key\": \"rzp_test_hgYa6e7RNnPSJf\",\n        //   \"amount\":\"500\", // 2000 paise = INR 20, amount in paisa\n        //   \"hostUrl\":`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`\n        // }\n      //   axios.post(`https://api.razorpay.com/v1/payments/${response.razorpay_payment_id}/capture`,\n      // {key_id:'rzp_test_hgYa6e7RNnPSJf',amount:x,checkcookie:1})\n      // .then(response=>{\n      //   console.log(response);\n      // })\n      // .catch(function (error) {\n      //   console.log(error);\n      // });\n            },\n            \"modal\": {\n              \"ondismiss\": function(){\n                  window.location.href='#'+redirect_url+'';\n               }\n          },\n      \"prefill\": {\n        \"name\": \"Shantanu Gupta\",\n        \"email\": \"shaang616@gmail.com\",\n        \"contact\":\"9654636775\"\n      },\n      \"notes\": {\n        \"address\": \"Hello World\"\n      },\n      \"theme\": {\n        \"color\": \"#3583D2\"\n      }\n    };\n\n    let rzp =new window.Razorpay(options); rzp.open();\n  }\n\n  render () {\n    const {loading,loading_msg}=this.state;\n    if(!loading)\n    {\n      return (\n        <div class=\"container loader_cont\" id=\"loader_cont\" style={{display:'none'}}><ActivityLoader\n          type=\"Triangle\"\n           color=\"black\"\n           height={100}\n           width={100}\n           />\n           <h3>{loading_msg}</h3>\n           </div>\n      )\n    }\n    else {\n      return(<div class=\"container loader_cont\"><ActivityLoader\n        type=\"Triangle\"\n         color=\"black\"\n         height={100}\n         width={100}/>\n         <h3>{loading_msg}</h3>\n         </div>)\n    }\n  }\n}\n\nexport default Authentication(Checkout)\n// <input type='text' onChange={\n//    this.changeAmount\n//   } />\n"]},"metadata":{},"sourceType":"module"}